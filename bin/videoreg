#!/usr/bin/env ruby

require 'rubygems'
require 'daemons'
require 'ostruct'
require 'optparse'
require 'dante'
require_relative '../lib/videoreg'

options = OpenStruct.new
options.script_name = File.basename($0)
ARGV.options do |parser|
  parser.banner = "Usage: #{options.script_name} [options]"

  parser.on('-s CONFIG', '--start CONFIG', 'Run ruby script') do |script|
    options.script = script
  end
  parser.on('-r', '--reset', 'Reset state (remove lock-files)') {
    Videoreg.perform_action = :clear
  }
  parser.on('-h', '--help', 'Show this help message') { puts parser; exit }
  parser.parse!

  if options.script && File.exists?(options.script)
    Dante.run('videoreg') do
      load(options.script)
    end
  else
    puts parser
  end
end

